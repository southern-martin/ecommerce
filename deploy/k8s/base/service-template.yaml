# =============================================================================
# Kubernetes manifests for all 19 ecommerce microservices.
# Each service follows the same pattern: Deployment + Service + HPA.
# =============================================================================

# -----------------------------------------------------------------------------
# Auth Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: auth-service
  namespace: ecommerce
  labels:
    app: auth-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: auth-service
  template:
    metadata:
      labels:
        app: auth-service
    spec:
      containers:
        - name: auth
          image: ghcr.io/southern-martin/ecommerce/auth:latest
          ports:
            - name: http
              containerPort: 8090
            - name: grpc
              containerPort: 9090
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8090"
            - name: GRPC_PORT
              value: "9090"
            - name: DB_NAME
              value: ecommerce_auth
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 3
---
apiVersion: v1
kind: Service
metadata:
  name: auth-service
  namespace: ecommerce
  labels:
    app: auth-service
spec:
  type: ClusterIP
  selector:
    app: auth-service
  ports:
    - name: http
      port: 8090
      targetPort: 8090
    - name: grpc
      port: 9090
      targetPort: 9090
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: auth-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: auth-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# User Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
  namespace: ecommerce
  labels:
    app: user-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
        - name: user
          image: ghcr.io/southern-martin/ecommerce/user:latest
          ports:
            - name: http
              containerPort: 8091
            - name: grpc
              containerPort: 9091
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8091"
            - name: GRPC_PORT
              value: "9091"
            - name: DB_NAME
              value: ecommerce_users
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: user-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: user-service
  ports:
    - name: http
      port: 8091
      targetPort: 8091
    - name: grpc
      port: 9091
      targetPort: 9091
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: user-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: user-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Product Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: product-service
  namespace: ecommerce
  labels:
    app: product-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: product-service
  template:
    metadata:
      labels:
        app: product-service
    spec:
      containers:
        - name: product
          image: ghcr.io/southern-martin/ecommerce/product:latest
          ports:
            - name: http
              containerPort: 8081
            - name: grpc
              containerPort: 9081
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8081"
            - name: GRPC_PORT
              value: "9081"
            - name: DB_NAME
              value: ecommerce_products
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: product-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: product-service
  ports:
    - name: http
      port: 8081
      targetPort: 8081
    - name: grpc
      port: 9081
      targetPort: 9081
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: product-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: product-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Cart Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cart-service
  namespace: ecommerce
  labels:
    app: cart-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: cart-service
  template:
    metadata:
      labels:
        app: cart-service
    spec:
      containers:
        - name: cart
          image: ghcr.io/southern-martin/ecommerce/cart:latest
          ports:
            - name: http
              containerPort: 8082
            - name: grpc
              containerPort: 9082
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8082"
            - name: GRPC_PORT
              value: "9082"
            - name: DB_NAME
              value: ecommerce_cart
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: cart-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: cart-service
  ports:
    - name: http
      port: 8082
      targetPort: 8082
    - name: grpc
      port: 9082
      targetPort: 9082
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: cart-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: cart-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Order Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service
  namespace: ecommerce
  labels:
    app: order-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: order-service
  template:
    metadata:
      labels:
        app: order-service
    spec:
      containers:
        - name: order
          image: ghcr.io/southern-martin/ecommerce/order:latest
          ports:
            - name: http
              containerPort: 8083
            - name: grpc
              containerPort: 9083
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8083"
            - name: GRPC_PORT
              value: "9083"
            - name: DB_NAME
              value: ecommerce_orders
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: order-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: order-service
  ports:
    - name: http
      port: 8083
      targetPort: 8083
    - name: grpc
      port: 9083
      targetPort: 9083
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: order-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: order-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Payment Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: payment-service
  namespace: ecommerce
  labels:
    app: payment-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: payment-service
  template:
    metadata:
      labels:
        app: payment-service
    spec:
      containers:
        - name: payment
          image: ghcr.io/southern-martin/ecommerce/payment:latest
          ports:
            - name: http
              containerPort: 8084
            - name: grpc
              containerPort: 9084
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8084"
            - name: GRPC_PORT
              value: "9084"
            - name: DB_NAME
              value: ecommerce_payments
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: payment-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: payment-service
  ports:
    - name: http
      port: 8084
      targetPort: 8084
    - name: grpc
      port: 9084
      targetPort: 9084
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: payment-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: payment-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Tax Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tax-service
  namespace: ecommerce
  labels:
    app: tax-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: tax-service
  template:
    metadata:
      labels:
        app: tax-service
    spec:
      containers:
        - name: tax
          image: ghcr.io/southern-martin/ecommerce/tax:latest
          ports:
            - name: http
              containerPort: 8098
            - name: grpc
              containerPort: 9098
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8098"
            - name: GRPC_PORT
              value: "9098"
            - name: DB_NAME
              value: ecommerce_tax
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: tax-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: tax-service
  ports:
    - name: http
      port: 8098
      targetPort: 8098
    - name: grpc
      port: 9098
      targetPort: 9098
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: tax-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: tax-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Shipping Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shipping-service
  namespace: ecommerce
  labels:
    app: shipping-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: shipping-service
  template:
    metadata:
      labels:
        app: shipping-service
    spec:
      containers:
        - name: shipping
          image: ghcr.io/southern-martin/ecommerce/shipping:latest
          ports:
            - name: http
              containerPort: 8085
            - name: grpc
              containerPort: 9085
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8085"
            - name: GRPC_PORT
              value: "9085"
            - name: DB_NAME
              value: ecommerce_shipping
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: shipping-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: shipping-service
  ports:
    - name: http
      port: 8085
      targetPort: 8085
    - name: grpc
      port: 9085
      targetPort: 9085
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: shipping-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: shipping-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Return Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: return-service
  namespace: ecommerce
  labels:
    app: return-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: return-service
  template:
    metadata:
      labels:
        app: return-service
    spec:
      containers:
        - name: return
          image: ghcr.io/southern-martin/ecommerce/return:latest
          ports:
            - name: http
              containerPort: 8086
            - name: grpc
              containerPort: 9086
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8086"
            - name: GRPC_PORT
              value: "9086"
            - name: DB_NAME
              value: ecommerce_returns
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: return-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: return-service
  ports:
    - name: http
      port: 8086
      targetPort: 8086
    - name: grpc
      port: 9086
      targetPort: 9086
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: return-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: return-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Search Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: search-service
  namespace: ecommerce
  labels:
    app: search-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: search-service
  template:
    metadata:
      labels:
        app: search-service
    spec:
      containers:
        - name: search
          image: ghcr.io/southern-martin/ecommerce/search:latest
          ports:
            - name: http
              containerPort: 8087
            - name: grpc
              containerPort: 9087
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8087"
            - name: GRPC_PORT
              value: "9087"
            - name: DB_NAME
              value: ecommerce_search
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: search-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: search-service
  ports:
    - name: http
      port: 8087
      targetPort: 8087
    - name: grpc
      port: 9087
      targetPort: 9087
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: search-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: search-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Review Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: review-service
  namespace: ecommerce
  labels:
    app: review-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: review-service
  template:
    metadata:
      labels:
        app: review-service
    spec:
      containers:
        - name: review
          image: ghcr.io/southern-martin/ecommerce/review:latest
          ports:
            - name: http
              containerPort: 8088
            - name: grpc
              containerPort: 9088
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8088"
            - name: GRPC_PORT
              value: "9088"
            - name: DB_NAME
              value: ecommerce_reviews
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: review-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: review-service
  ports:
    - name: http
      port: 8088
      targetPort: 8088
    - name: grpc
      port: 9088
      targetPort: 9088
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: review-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: review-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Media Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: media-service
  namespace: ecommerce
  labels:
    app: media-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: media-service
  template:
    metadata:
      labels:
        app: media-service
    spec:
      containers:
        - name: media
          image: ghcr.io/southern-martin/ecommerce/media:latest
          ports:
            - name: http
              containerPort: 8089
            - name: grpc
              containerPort: 9089
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8089"
            - name: GRPC_PORT
              value: "9089"
            - name: DB_NAME
              value: ecommerce_media
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: media-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: media-service
  ports:
    - name: http
      port: 8089
      targetPort: 8089
    - name: grpc
      port: 9089
      targetPort: 9089
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: media-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: media-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Notification Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: notification-service
  namespace: ecommerce
  labels:
    app: notification-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: notification-service
  template:
    metadata:
      labels:
        app: notification-service
    spec:
      containers:
        - name: notification
          image: ghcr.io/southern-martin/ecommerce/notification:latest
          ports:
            - name: http
              containerPort: 8092
            - name: grpc
              containerPort: 9092
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8092"
            - name: GRPC_PORT
              value: "9092"
            - name: DB_NAME
              value: ecommerce_notifications
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: notification-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: notification-service
  ports:
    - name: http
      port: 8092
      targetPort: 8092
    - name: grpc
      port: 9092
      targetPort: 9092
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: notification-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: notification-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# CMS Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cms-service
  namespace: ecommerce
  labels:
    app: cms-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: cms-service
  template:
    metadata:
      labels:
        app: cms-service
    spec:
      containers:
        - name: cms
          image: ghcr.io/southern-martin/ecommerce/cms:latest
          ports:
            - name: http
              containerPort: 8099
            - name: grpc
              containerPort: 9099
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8099"
            - name: GRPC_PORT
              value: "9099"
            - name: DB_NAME
              value: ecommerce_cms
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: cms-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: cms-service
  ports:
    - name: http
      port: 8099
      targetPort: 8099
    - name: grpc
      port: 9099
      targetPort: 9099
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: cms-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: cms-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Promotion Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: promotion-service
  namespace: ecommerce
  labels:
    app: promotion-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: promotion-service
  template:
    metadata:
      labels:
        app: promotion-service
    spec:
      containers:
        - name: promotion
          image: ghcr.io/southern-martin/ecommerce/promotion:latest
          ports:
            - name: http
              containerPort: 8093
            - name: grpc
              containerPort: 9093
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8093"
            - name: GRPC_PORT
              value: "9093"
            - name: DB_NAME
              value: ecommerce_promotions
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: promotion-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: promotion-service
  ports:
    - name: http
      port: 8093
      targetPort: 8093
    - name: grpc
      port: 9093
      targetPort: 9093
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: promotion-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: promotion-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Loyalty Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: loyalty-service
  namespace: ecommerce
  labels:
    app: loyalty-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: loyalty-service
  template:
    metadata:
      labels:
        app: loyalty-service
    spec:
      containers:
        - name: loyalty
          image: ghcr.io/southern-martin/ecommerce/loyalty:latest
          ports:
            - name: http
              containerPort: 8096
            - name: grpc
              containerPort: 9096
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8096"
            - name: GRPC_PORT
              value: "9096"
            - name: DB_NAME
              value: ecommerce_loyalty
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: loyalty-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: loyalty-service
  ports:
    - name: http
      port: 8096
      targetPort: 8096
    - name: grpc
      port: 9096
      targetPort: 9096
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: loyalty-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: loyalty-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Affiliate Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: affiliate-service
  namespace: ecommerce
  labels:
    app: affiliate-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: affiliate-service
  template:
    metadata:
      labels:
        app: affiliate-service
    spec:
      containers:
        - name: affiliate
          image: ghcr.io/southern-martin/ecommerce/affiliate:latest
          ports:
            - name: http
              containerPort: 8097
            - name: grpc
              containerPort: 9097
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8097"
            - name: GRPC_PORT
              value: "9097"
            - name: DB_NAME
              value: ecommerce_affiliates
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: affiliate-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: affiliate-service
  ports:
    - name: http
      port: 8097
      targetPort: 8097
    - name: grpc
      port: 9097
      targetPort: 9097
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: affiliate-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: affiliate-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# Chat Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: chat-service
  namespace: ecommerce
  labels:
    app: chat-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: chat-service
  template:
    metadata:
      labels:
        app: chat-service
    spec:
      containers:
        - name: chat
          image: ghcr.io/southern-martin/ecommerce/chat:latest
          ports:
            - name: http
              containerPort: 8094
            - name: grpc
              containerPort: 9094
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8094"
            - name: GRPC_PORT
              value: "9094"
            - name: DB_NAME
              value: ecommerce_chat
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: chat-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: chat-service
  ports:
    - name: http
      port: 8094
      targetPort: 8094
    - name: grpc
      port: 9094
      targetPort: 9094
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: chat-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: chat-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
---
# -----------------------------------------------------------------------------
# AI Service
# -----------------------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ai-service
  namespace: ecommerce
  labels:
    app: ai-service
    app.kubernetes.io/part-of: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: ai-service
  template:
    metadata:
      labels:
        app: ai-service
    spec:
      containers:
        - name: ai
          image: ghcr.io/southern-martin/ecommerce/ai:latest
          ports:
            - name: http
              containerPort: 8095
            - name: grpc
              containerPort: 9095
          envFrom:
            - configMapRef:
                name: ecommerce-config
            - secretRef:
                name: ecommerce-secrets
          env:
            - name: HTTP_PORT
              value: "8095"
            - name: GRPC_PORT
              value: "9095"
            - name: DB_NAME
              value: ecommerce_ai
          resources:
            requests:
              cpu: 200m
              memory: 256Mi
            limits:
              cpu: "1"
              memory: 1Gi
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 30
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 10
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: ai-service
  namespace: ecommerce
spec:
  type: ClusterIP
  selector:
    app: ai-service
  ports:
    - name: http
      port: 8095
      targetPort: 8095
    - name: grpc
      port: 9095
      targetPort: 9095
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: ai-service-hpa
  namespace: ecommerce
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: ai-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
